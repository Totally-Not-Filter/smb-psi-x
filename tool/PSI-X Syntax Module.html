<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>VASM: Psi-X Syntax Module</title>

<meta name="description" content="VASM: Psi-X Syntax Module">
<meta name="keywords" content="VASM: Psi-X Syntax Module">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 5.0">

<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:pre}
span.nolinebreak {white-space:pre}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">



<hr>
<a name="Psi-X-Syntax-Module"></a>
<a name="Psi-X-Syntax-Module-1"></a>
<h1 class="chapter">Psi-X Syntax Module</h1>
<p>This document describes the Psi-X syntax module, inspired by the Psy-Q family of assemblers. It is suitable for multiple CPUs (M68K, Z80, 6502, etc.) and is available with the extension <code>psi-x</code>.
</p>
<hr>
<a name="Author"></a>
<h2 class="section">Author</h2>

<p>    This module was created in 2024 by 'Naoto' and is intended for use with a custom fork of VASM, which can be found here:
<a href="https://github.com/NaotoNTP/vasm-psi-x/">https://github.com/NaotoNTP/vasm-psi-x/</a></p>
<hr>
<a name="Additional-Options-For-This-Module-2"></a>
<h2 class="section">Additional Options For This Module</h2>
 
<p>This syntax module provides the following additional options:
</p> 
<dl compact="compact">

<dt>‘<samp>-noalign</samp>’</dt>
<dd><p> Disables natural alignment for data (i.e. <code>dc</code>, <code>ds</code>) and
 offset directives (<code>rs</code>).
</p>
</dd>

<dt>‘<samp>-altlocal</samp>’</dt>
<dd><p> Local symbols are prefixed by <code>'.'</code> instead of <code>'@'</code>.
</p>
</dd>

<dt>‘<samp>-altnum</samp>’</dt>
<dd><p> Enables intel-style numeric-base suffixes (i.e. <code>0h</code>, <code>0b</code>).
</p>
</dd>

<dt>‘<samp>-ldots</samp>’</dt>
<dd><p> Allow dots (<code>.</code>) within all identifiers.
</p>
</dd>

<dt>‘<samp>-spaces</samp>’</dt>
<dd><p> Allow whitespace characters in expressions.
</p>
</dd>

</dl>
<hr>
<a name="General-Syntax-1"></a>
<h2 class="section">General Syntax</h2>

<p>Labels must either start at the first column of a line or must be
terminated by a colon character (<code>:</code>). In both cases, a mnemonic on the same
line must be separated from the label by whitespace or assignment operator (i.e. <code>=</code>).
Additionally, terminating a label with a double colon (<code>::</code>)
declares that label externally visible (see also <code>xdef</code>).
</p>
<p>Labels are declared as local when prefixed with ’<code>@</code>’ (’<code>.</code>’ when using the <code>-altlocal</code> option)
or when suffixed with ’<code>$</code>’. Additionally, label names cannot begin with a digit (0-9) as the first character.
With respect to these restrictions, any alphanumeric character, including ’<code>_</code>’ is permitted.
Local labels may be referenced anywhere in the scope between two global label declarations.
</p>
<p>It is possible to refer to any local label/symbol in the source by preceding its
name with the global label (aka parent label) it belongs to with a separating colon or dot character like so:
<code>global_name:local_name</code> or <code>global_name.local_name</code>. This is not generally recommended 
for referencing labels in code; rather, it is best to reserve this practice for referencing fields within 
a structure (see also <code>struct</code>).
</p>
<p>Anonymous labels are also supported. They are declared with a single ’<code>:</code>’
at the beginning of a line. They may be referenced by ’<code>:</code>’ followed
directly by one or more ’<code>+</code>’ or ’<code>-</code>’ signs. A <code>+</code> selects
the first anonymous label following the point of reference. A <code>++</code>
select the second anonymous label in that direction, and so on. A <code>-</code>
selects the first anonymous label before the point of reference. Example:
</p><div class="example">
<pre class="example">:	jmp	:-	; infinite loop
</pre></div>

<p>The option ‘<samp>-ldots</samp>’ allows dots (<code>.</code>) within labels, symbols, and other
identifiers. However, the ending of these identifiers may not conflict with the target architecture’s reserved 
qualifiers (i.e. <code>.b</code>, <code>.w</code> or <code>.l</code> when targeting M68K).
</p>
<p>Operands are separated from the mnemonic by whitespace. Multiple
operands are separated from each other by commas (<code>,</code>).
</p>
<p>Be sure to avoid declaring a label on the same line as a non-assignment
directive for conditional assembly (if, else, endif, etc.), as this is not supported by the assembler.
</p>
<p>Comments are introduced by the comment character (<code>;</code>). The assembler will attempt 
to issue a warning if a comment is introduced at the end of a line without the comment character,
but this is not guaranteed. Additionally, multi-line comment blocks are supported by way of the <code>comment</code> directive.
<p>Examples:
</p><div class="example">
<pre class="example">label:	instr.q	op1,op2	; comment</pre>
<pre class="example"> </pre>
<pre class="example">	comment</pre>
<pre class="example">........................</pre>
<pre class="example">multi-line comment block</pre>
<pre class="example">........................</pre>
<pre class="example">	comend</pre>
</div>

<p>In expressions, numbers starting with <code>$</code> are hexadecimal (i.e.
<code>$FB2C</code>). For Z80, <code>&amp;</code> may also be used as a hexadecimal prefix,
but make sure to avoid conflicts with the and-operator (either by using
parentheses or blanks).
<code>%</code> introduces binary numbers (i.e. <code>%1100101</code>).
Numbers starting with <code>@</code> are assumed to be octal numbers, i.e.
<code>@237</code> (except for Z80, where it means binary).
</p>
<p>
A special case is a digit followed by a <code>_</code>, which can be used to
define an arbitrary base between 2 and 9 (i.e. <code>4_3012</code>).
Intel-style numeric base suffixes are supported when the <code>-altnum</code> option has been specified: 
<code>h</code> for hexadecimal, <code>d</code> for decimal, <code>o</code> or <code>q</code> for octal and <code>b</code> for
binary. Hexadecimal intel-style numbers must start with a digit (add leading
<code>0</code>s where required).
C-style prefixes are also supported for hexadecimal (<code>0x</code>), octal (<code>0q</code>), and
binary (<code>0b</code>).
</p>
<p>
All other numbers starting with a digit are decimal by default (i.e. <code>1239</code>).
However, the <code>radix</code> directive may be used to change the default numeric base within a range of 2 to 16. 
Note that for numeric base values higher than 10, recognition of intel-style suffixes will be temporarily
disabled until the base value is changed to be 10 or below. This is done in order to avoid conflicts between suffixes and hexadecimal 
digits (<code>d</code> and <code>b</code>).
Additionally, numbers must still start with a decimal digit to be valid with numeric base values higher than 10 (oncemore, add leading
<code>0</code>s as required).
</p>

<hr>
<a name="Directives-1"></a>
<h2 class="section">Directives</h2>

<p>The following directives are supported by this syntax module (if the
CPU- and output-module allow it):
</p>
<dl compact="compact">

<dt><code>&lt;symbol&gt; = &lt;expression&gt;</code></dt>
<dd>
<p>      Equivalent to <code>&lt;symbol&gt; set &lt;expression&gt;</code>.
</p>
</dd>

<dt><code>&lt;symbol&gt; == &lt;expression&gt;</code></dt>
<dd>
<p>      Equivalent to <code>&lt;symbol&gt; equ &lt;expression&gt;</code>.
</p>
</dd>

<dt><code>&lt;symbol&gt; alias &lt;internalsym&gt;</code></dt>
<dd><p>      Allows the programmer to asign an alternate name given by <code>&lt;symbol&gt;</code>
	to the internal, reserved symbol specified <code>&lt;internalsym&gt;</code>. Can also be used to
	reactivate internal symbol names that were deactivated by the <code>disable</code> directive; simply
	do the following with an existing alias: <code>&lt;internalsym&gt; alias &lt;symbol&gt;</code>.
</p>
</dd>

<dt><code>align &lt;alignment&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>      Insert as many padding bytes as are needed to reach an address divisible 
	  by <code>&lt;alignment&gt;</code>. For example <code>align 4</code> would pad fill bytes
	  until the current address is aligned to the next 32-bit boundary. The padding bytes can be assigned 
	  a value other than <code>0</code> via the optional <code>&lt;fill&gt;</code> parameter.
</p>
</dd>

<dt><code>case &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>      Conditional case directive. Conditionally assemble the following lines if one of the listed 
	expressions matches the result of the expression given to the current switch statement. 
	See also <code>switch</code>.
</p>
</dd>

<dt><code>cnop &lt;offset&gt;,&lt;alignment&gt;</code></dt>
<dd><p>      Insert as many padding bytes as are needed to reach an address divisible 
	by <code>&lt;alignment&gt;</code>. Then, add <code>&lt;offset&gt;</code> padding bytes.
</p>
</dd>

<dt><code>comment/comend</code></dt>
<dd><p>      Multi-line comment directives. The assembler will ignore everything from encountering the <code>comment</code>
	directive until a <code>comend</code> directive is found, at which point normal assembly continues.
</p>
</dd>

<dt><code>data &lt;value1&gt;[,&lt;value2&gt;...]</code></dt>
<dd><p>      Assigns the constant integer values of the list of operands into successive bytes 
	of memory within the current section. Works similarly to the declare constant directives, but the 
	size each value occupies in bytes is specified by a value given to the <code>datasize</code> directive.
	Currently exclusive to M68K.
</p>
</dd>

<dt><code>datasize &lt;size&gt;</code></dt>
<dd><p>      Specifies the number of bytes each operand of the <code>data</code> directive should occupy in memory.
	The accepted range is between between 1 and 16 bytes (8 to 128 bits). The default value is set to 1 byte.
	Note that the base specified by the <code>radix</code> does not affect how the value of <code>&lt;size&gt;</code>
	is parsed when no numeric base prefix/suffix is given; it will always be parsed as a decimal value when a prefix/suffix
	is absent. Currently exclusive to M68K.
</p>
</dd>

<dt><code>default</code></dt>
<dd><p>      Built-in mnemonic alias for the <code>else</code> directive, intended for use within switch statement blocks. 
	See also <code>switch</code>.
</p>
</dd>

<dt><code>disable &lt;inernalsym&gt;</code></dt>
<dd><p>      Allows the programmer to disable the internal, reserved symbol specified <code>&lt;inernalsym&gt;</code>.
	Useful for avoiding name conflicts with the programmer's own symbols. It is recommended, but not required,
	that this directive is used in conjuction with the <code>alias</code> directive to assign the internal symbol
	an alternate name by which it can be referenced at the programmer's discretion.
</p>
</dd>

<dt><code>do</code></dt>
<dd><p>      Invokes a do-until conditional loop block. See <code>until</code> for more information.
</p>
</dd>

<dt><code>db &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;str1&gt;&quot;,'&lt;str2&gt;'...]</code></dt>
<dt><code>dw &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dt><code>dl &lt;exp1&gt;[,&lt;exp2&gt;...]</code></dt>
<dd><p>      Z80/6502 declare constant directives. Assigns the constant integer values of the list of operands 
	into successive bytes of memory within the current section. How many bytes each operand value occupies depends on the specific directive used:
	<code>db</code> assigns bytes, <code>dw</code> assigns words, and <code>dl</code> assigns longwords. Additionally, <code>db</code> accepts string operands, 
	wherein each character in the string is assigned to consecutive bytes in memory, in the order they appear.
</p>
</dd>

<dt><code>dc[.&lt;sz&gt;] &lt;exp1&gt;[,&lt;exp2&gt;,&quot;&lt;str1&gt;&quot;,'&lt;str2&gt;'...]</code></dt>
<dd><p>      M68K declare constant directive. Assigns the constant integer values of the list of operands 
	into successive bytes of memory within the current section. <code>&lt;sz&gt;</code> defaults to <code>w</code> when not specified.
	When a <code>&lt;sz&gt;</code> of <code>b</code> is specified, strings can also be given as operands.
</p>
</dd>

<dt><code>dcb &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dt><code>dcw &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dt><code>dcl &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>      Z80/6502 declare constant block directives. Insert <code>&lt;exp&gt;</code> zero or <code>&lt;fill&gt;</code> 
	bytes, words, or longwords into the current section as specified by the selected directive.
</p>
</dd>

<dt><code>dcb[.&lt;sz&gt;] &lt;exp&gt;[,&lt;fill&gt;]</code></dt>
<dd><p>      M68K declare constant block directive. Insert <code>&lt;exp&gt;</code> zero or <code>&lt;fill&gt;</code> 
	bytes, words, or longwords into the current section as specified by <code>&lt;sz&gt;</code>. 
	<code>&lt;sz&gt;</code> defaults to <code>w</code> when not specified.
</p>
</dd>

<dt><code>ds &lt;exp&gt;</code></dt>
<dt><code>dsb &lt;exp&gt;</code></dt>
<dt><code>dsw &lt;exp&gt;</code></dt>
<dt><code>dsl &lt;exp&gt;</code></dt>
<dd><p>      Z80/6502 define storage directives. Equivalent to declaring a constant block with a fill value of zero.
	Intended for defining storage in sections with uninitialized data. <code>ds/dsb</code> corresponds to byte storage,
	<code>dsw</code> corresponds to word storage, and <code>dsl</code> corresponds to longword storage.
</p>
</dd>

<dt><code>ds[.&lt;sz&gt;] &lt;exp&gt;</code></dt>
<dd><p>      M68K define storage directive. Equivalent to <code>dcb.&lt;sz&gt; &lt;exp&gt;,0</code>.
	Intended for defining storage in sections with uninitialized data. 
</p>
</dd>

<dt><code>else</code></dt>
<dd><p>      Assemble the following lines when the previous <code>if</code>-condition
      was false.
</p>
</dd>

<dt><code>elseif</code></dt>
<dd><p>      equivalent to <code>else</code> followed by <code>if</code> on the next line, but without the
	need for a matching <code>endif</code>/<code>endc</code> directive. This helps avoid nesting.
</p>
</dd>

<dt><code>end</code></dt>
<dd><p>      End assembly and ignore everything after this line.
</p>
</dd>

<dt><code>endc/endif</code></dt>
<dd><p>      Ends a block of conditional assembly. See <code>if</code> and <code>switch</code> for more information.
</p>
</dd>

<dt><code>endm</code></dt>
<dd><p>      Ends a macro definition. See <code>macro</code> for more information.
</p>
</dd>

<dt><code>endr</code></dt>
<dd><p>      Ends a repetition block. See <code>rept</code>, <code>irp</code>, and <code>irpc</code> for more information.
</p>
</dd>

<dt><code>endw</code></dt>
<dd><p>      Ends a while-loop block. See <code>while</code> for more information.
</p>
</dd>

<dt><code>&lt;symbol&gt; equ &lt;expression&gt;</code></dt>
<dd><p>      Defines a new program symbol with the name <code>&lt;symbol&gt;</code> 
	and assign it a constant value specified by <code>&lt;expression&gt;</code>. 
	Note that attempting to reassign the value of <code>&lt;symbol&gt;</code> beyond 
	this point will cause an error. If you need to be able to redifne the value of
	as symbol, use the <code>set</code> directive instead.
</p>
</dd>

<dt><code>&lt;strsym&gt; equs "&lt;string&gt;"</code></dt>
<dt><code>&lt;strsym&gt; equs '&lt;string&gt;'</code></dt>
<dt><code>&lt;strsym&gt; equs &lt;symbol&gt;</code></dt>
<dd><p>      Defines a new string symbol with the name <code>&lt;strsym&gt;</code> 
	and assigns it either a constant quoted string value (<code>&lt;string&gt;</code>) or
	the string value assigned to an existing string symbol (<code>&lt;symbol&gt;</code>).
	Unlike <code>equ</code>, it is possible to redefine the string value associated with <code>&lt;strsym&gt;</code>.</p><p>
	After a string symbol has been declared, the string value of assigned to it can
	can be referenced anywhere in the code, either by enclosing the name <code>&lt;strsym&gt;</code> in
	curly braces (<code>{&lt;strsym&gt;}</code>) or by referencing it with a leading backslash (<code>\&lt;strsym&gt;</code>).
	In instances were a leading backslash is used, a trailing backslash may also be used to separate <code>&lt;strsym&gt;</code>
	from any trailing text that may confuse the string symbol expansion parser (<code>\&lt;strsym&gt;\</code>).</p><p>
	As the assembler continues to read lines from the current source-file, any string symbol invocations present
	on the current line will be replaced with the value of <code>&lt;string&gt;</code> or the string value that
	was assigned to <code>&lt;symbol&gt;</code>. 
	For example, if a symbol named <code>foo</code> is assigned a string value of <code>"bar"</code>, 
	anywhere in the current source where <code>{foo}</code>, <code>\foo</code>, or <code>\foo\</code> is written 
	will be pre-processed and interpreted as the text <code>bar</code> during assembly.</p>
<p>	As such, this line:</p>
<div class="example">
<pre class="example">\foo:	dc.b	"{foo}","\foo\foo","foo"
</pre></div>
<p>	Will be interpreted by the assembler as:</p>
<div class="example">
<pre class="example">bar:	dc.b	"bar","barfoo","foo"
</pre></div>
<p>		Due to the specific nature of its usage and application, the string value associated with a string 
	symbol is not made externally visible or used in linkable objects beyond the source in which they were defined.
	However, source files that have been incorporated into the current source via the <code>include</code> directive 
	are considered to be part of that current source, allowing usage of string symbols as intended within those files.
	Attempting to export a string symbol will simply communicate that a symbol of that name has been defined somewhere 
	in the source.</p>
<p>		Referencing a string symbol as though it were a standard symbol, without slashes or curly braces within
	the context of an expression, evaluates to the assigned string's length. For example,	a string symbol that has been assigned 
	the phrase <code>"Hello world!"</code> will evaluate to a value of <code>12</code>. This property may be useful in
	situations where manually calculating the length of an assigned string would negatively impact the readability of the code.
</p>
</dd>

<dt><code>even</code></dt>
<dd><p>      Aligns to an even address. Equivalent to <code>cnop 0,2</code> or <code>align 2</code>.
</p>
</dd>

<dt><code>fail</code></dt>
<dd><p>      Throw a fatal error and stop assembly immediately; do not generate
	an output file.
</p>
</dd>

<dt><code>global &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>      Flag <code>&lt;symbol&gt;</code> as an global symbol, which means that <code>&lt;symbol&gt;</code> is
	visible to all modules in the linking process. It may be either defined or undefined.  
</p>
</dd>

<dt><code>hex &lt;hexstream&gt;</code></dt>
<dd><p>      Assigns a stream of hex values into successive bytes of memory within the current section.
	This directive serves as a quick way to declare hex data; an even number of nybbles must be specified,
	suffixes/prefixes should be ommitted, and no space or delimiting characters should be present in the operand.
	It is recommended that users limit their use of this directive by making use of other data declaration and 
	binary file inclusion directives wherever possible, as the resulting hex-streams are often less readable and
	make more work for the assembler.
</p>
</dd>

<dt><code>ieee32 &lt;fpnum1&gt;[,&lt;fpnum2&gt;...]</code></dt>
<dt><code>ieee64 &lt;fpnum1&gt;[,&lt;fpnum2&gt;...]</code></dt>
<dd><p>      Floating-point define constant directives. Assigns the constant floating-point number values to successive 
	bytes of memory within the current section. <code>ieee32</code> is used to define single-precision floating-point values,
	while <code>ieee64</code> is used to define double-precision floating-point values.
</p>
</dd>

<dt><code>if &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is non-zero.
</p>
</dd>

<dt><code>ifb &lt;operand&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines when <code>&lt;operand&gt;</code> is
      completely blank, except for an optional comment.
</p>
</dd>

<dt><code>ifnb &lt;operand&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines when <code>&lt;operand&gt;</code> is
      non-blank.
</p>
</dd>

<dt><code>ifc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;string1&gt;</code> matches
	<code>&lt;string2&gt;</code>.
</p>
</dd>

<dt><code>ifnc &lt;string1&gt;,&lt;string2&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;string1&gt;</code> does not
      match <code>&lt;string2&gt;</code>.
</p>
</dd>

<dt><code>ifd &lt;symbol&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;symbol&gt;</code> is defined.
</p>
</dd>

<dt><code>ifnd &lt;symbol&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;symbol&gt;</code> is undefined.
</p>
</dd>

<dt><code>ifeq &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is zero.
</p>
</dd>

<dt><code>ifne &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is non-zero.
</p>
</dd>

<dt><code>ifgt &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is
      greater than zero.
</p>
</dd>

<dt><code>ifge &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is
      greater than zero or equal.
</p>
</dd>

<dt><code>iflt &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is
      less than zero.
</p>
</dd>

<dt><code>ifle &lt;expression&gt;</code></dt>
<dd><p>      Conditionally assemble the following lines if <code>&lt;expression&gt;</code> is
      less than zero or equal.
</p>
</dd>

<dt><code>iif &lt;expression&gt; &lt;statement&gt;</code></dt>
<dd><p>		Immediate if statement directive. Conditionally assemble the <code>&lt;statement&gt;</code> 
	following <code>&lt;expression&gt;</code>.
	If the value of <code>&lt;expression&gt;</code> is non-zero then <code>&lt;statement&gt;</code> is assembled.
	No <code>endc/endif</code> must be used in conjunction with this directive, as it only takes into account the contents of a single line.
	The <code>&lt;statement&gt;</code> cannot include a label, but a label may precede the
	<code>iif</code> directive. </p>
<p>For example:</p>
<div class="example">
<pre class="example">foo:	iif	bar	equ	42
</pre></div>
<p>		The symbol <code>foo</code> will be assigned a value of <code>42</code> if <code>bar</code>
	evaluates to true, otherwise <code>foo</code> will be treated as a label definition and assigned the current 
	value of the program counter.
	Excercise caution when assigning a value in the <code>iif &lt;statement&gt;</code> using
	the equal (<code>= or ==</code>) operators; when used in conjuction with the <code>-spaces</code> 
	syntax option, these operators may be evaluated as part of the expression instead.
	For example, with the <code>-spaces</code> option specified, <code>foo iif 1+1 = 42</code> works as intended,
	but <code>foo iif 1 + 1 = 42</code> does not, as <code>= 42</code> is evaluated as part of the expression.
</p>
</dd>

<dt><code>incbin &lt;filename&gt;[,&lt;offset&gt;[,&lt;length&gt;]]</code></dt>
<dd><p>	Inserts the binary contents of <code>&lt;filename&gt;</code> into the object code at
	this position. When <code>&lt;offset&gt;</code> is specified, then the given number
	of bytes will be skipped at the beginning of the file. The optional
	<code>&lt;length&gt;</code> argument specifies the maximum number of bytes to be read
	from that file.
</p>
</dd>

<dt><code>incdir &lt;path&gt;</code></dt>
<dd><p>      Add another path to search for include files to the list of
      known paths. Paths defined with <code>-I</code>; on the command line are
      searched first.
</p>
</dd>

<dt><code>include &lt;filename&gt;</code></dt>
<dd><p>		Include source text of <code>&lt;filename&gt;</code> at this position. 
	When the file name specified has no absolute path, then search it in all defined 
	paths in the order of occurrence, starting with the current work directory.
</p>
</dd>

<dt><code>inform &lt;severity&gt;,&lt;message&gt;</code></dt>
<dd><p>      Prints a user-defined message of the specificed <code>&lt;severity&gt;</code> 
	level and perform additional actions as necessary. A <code>&lt;severity&gt;</code> of
	<code>0</code> prints a message, <code>1</code> issues a warning, <code>2</code> issues
	an error, which prevents the generation of an output file but allows assembly to continue,
	and <code>3</code> issues a fatal error, terminating assembly immediately.
</p>
</dd>

<dt><code>irp &lt;symbol&gt;[,&lt;val&gt;...]</code></dt>
<dd><p>      Iterates the block between <code>irp</code> and <code>endr</code> for each
      <code>&lt;val&gt;</code>. The current <code>&lt;val&gt;</code>, which may be embedded in quotes,
      is assigned to <code>\symbol</code>. If no value is given, then the block is
      assembled once, with <code>\symbol</code> set to an empty string.
</p>
</dd>

<dt><code>irpc &lt;symbol&gt;[,&lt;val&gt;...]</code></dt>
<dd><p>      Iterates the block between <code>irpc</code> and <code>endr</code> for each
      character in each <code>&lt;val&gt;</code>, and assign it to <code>\symbol</code>.
      If no value is given, then the block is assembled once, with
      <code>\symbol</code> set to an empty string.
</p>
</dd>

<dt><code>list</code></dt>
<dd><p>      The following lines will appear in the listing file, if it was
      requested.
</p>
</dd>

<dt><code>local &lt;macvar1&gt;[,&lt;macvar2&gt;...]</code></dt>
<dd><p>      Defines a list of variables unique to the internal context of a macro. Macro variables
	remain undefined until they are used by the programmer, allowing these variables to be used as lables
	or any other type of symbol.
</p>
</dd>

<dt><code>&lt;name&gt; macro [&lt;argname1&gt;[,&lt;argname2&gt;...]]</code></dt>
<dd><p>		Defines a macro which can be referenced by <code>&lt;name&gt;</code>.
	The macro definition is terminated by an <code>endm</code> directive. Up to 64
	named arguments, separated by commas, may be defined for use within the macro 
	context. It is recommened, but not required, to preceded precede named macro arguments
	with a backslash character like so: <code>\argname</code>. An optional trailing backslash
	may also be specified to separate the macro argument from any surrounding text: <code>\argname\</code>
	In addition to named arguments, up to 9 numbered arguments passed during a macro call can be 
	referenced within the macro context as <code>\1</code> to <code>\9</code>. 
	A special argument, <code>\0</code>, is set to the macro&rsquo;s first qualifier 
	(dot size) when given on supported CPUs, such as the M68K. 
	If you need to pass a macro argument which contains commas or spaces
	(i.e. a list of elements), you must enclose it between <code>{</code> and <code>}</code> 
	characters. 

</p>
<p>      Special macro parameters:
</p><dl compact="compact">
<dt><code>\@</code></dt>
<dd><p>      Insert a unique id, useful for defining labels. Every macro call
      gets its own unique id.
</p></dd>

<dt><code>\?n or \?argname</code></dt>
<dd><p>      Inserts <code>1</code> (true) if the referenced macro argument (<code>argname</code>
	 or <code>n</code>&rsquo;th unnamed argument) is non-blank; inserts <code>0</code> (false) otherwise.
</p></dd>

<dt><code>\#symbolname</code></dt>
<dd><p>      Inserts the current decimal value of the absolute
      symbol <code>symbolname</code>.
</p></dd>

<dt><code>\$symbolname</code></dt>
<dd><p>      Inserts the current hexadecimal value of the absolute
      symbol <code>symbolname</code>, without leading <code>$</code>.
</p></dd>
</dl>

<dt><code>&lt;name&gt; macros [&lt;argname1&gt;[,&lt;argname2&gt;...]]</code></dt>
<dd><p>      Short macro declaration. Declares a single-line macro definition with no need for a 
	corresponding <code>endm</code> directive. Useful for modeling directives from other assemblers
	or psuedo-instructions.
</p>
<p>		Example:
</p><div class="example">
<pre class="example">define	macros	name, text	; short macro to immitate a C-like define directive</pre>
<pre class="example">	\name:	equs	"\text"	; no 'endm' needed after this; the short macro definition terminates after this line is read</pre>
</div>
</dd>

<dt><code>mexit</code></dt>
<dd><p>      Leave the current macro and continue with assembling the parent
      context. Note that this directive also resets the level of conditional
      assembly to a state before the macro was invoked; which means that
      it also works as a &rsquo;break&rsquo; command on all new <code>if</code> directives.
</p>
</dd>

<dt><code>module/modend</code></dt>
<dd><p>      Local labels following the <code>module</code> directive are isolated from previous
      local labels until a <code>modend</code> directive is encountered, which allows reuse of local 
	  label/symbol names within the block created.
</p>
</dd>

<dt><code>nolist</code></dt>
<dd><p>      The following lines will not be visible in a listing file.
</p>
</dd>

<dt><code>obj &lt;expression&gt;/objend</code></dt>
<dd><p>      Relocate all labels between <code>obj</code> and <code>objend</code> based on the
      new origin from <code>&lt;expression&gt;</code>.
</p>
</dd>

<dt><code>opt &lt;option1&gt;[,&lt;option2&gt;...]</code></dt>
<dd><p>      Syntax options directive. Allows the user to specify a list of syntax options and their state from that point forward.
	Listing the code followed by a <code>'+'</code> will set the option to on, while specifying a <code>'-'</code> will set it to off.
	<code>'+'</code> and <code>'-'</code> have special meanings in the case of the <code>l</code> option, which is elaborated upon
	in the list below.
</p>
<p>      Option Codes:
</p><dl compact="compact">
<dt><code>ae</code></dt>
<dd><p>         Automatic Even - Specifies whether data declaration or offset directives are automatically aligned to the architecture’s
	natural alignment. The default setting is <code>ae+</code> unless the <code>-noalign</code> build option was given.
</p>
</dd>
<dt><code>an</code></dt>
<dd><p>         Alternate Numeric - Specifies whether intel-style numeric suffixes are accepted for hexadecimal, octal, or binary numbers
	The default setting is <code>an-</code> unless the <code>-altnum</code> build option was given.
</p>
</dd>
<dt><code>c</code></dt>
<dd><p>          Case Sensitivity - Specifies symbol names are case-sensitive.
	The default setting is <code>c+</code> unless the <code>-nocase</code> build option was given.
</p>
</dd>
<dt><code>l</code></dt>
<dd><p>         Local Symbol Character - Specifies the character for prefixed local symbols to use.
	<code>'+'</code> corresponds to <code>'.'</code>, while <code>'-'</code> corresponds to <code>'@'</code>.
	If desired, an arbitary character can be specified in place of the on/off signifier. For instance, if
	<code>l?</code> is given, this will change the prefixed local symbol character to <code>'?'</code>. Be mindful
	that use of this may have unintended effects and, as such, should be used with care.
	The default setting is <code>l-</code> unless the <code>-altlocal</code> build option was given.
</p>
</dd>
<dt><code>w</code></dt>
<dd><p>         Print Warning Messages - Specifies whether or not the assembler should print warning messages.
	The default setting is <code>w+</code> unless the <code>-w</code> build option was given.
</p>            
</dd>
<dt><code>ws</code></dt>
<dd><p>         Allow Whitespace - Specifies whether or not to allow white-space characters in operands and expressions.
	The default setting is <code>ws-</code> unless the <code>-spaces</code> build option was given.
</p>            
</dd>
</dl>

<dt><code>org &lt;expression&gt;</code></dt>
<dd><p>      Set the base address for the subsequent code to <code>&lt;expression&gt;</code>.
</p>
</dd>

<dt><code>public &lt;'on' or 'off'&gt;</code></dt>
<dd><p>      Directive to automatically make declared symbols/labels externally visible. 
	<code>public on</code> makes all new symbol/label declarations following it externally
	visible, <code>public off</code> disables this behavior. Off by default. See also <code>xdef</code>.
</p>
</dd>

<dt><code>purge &lt;macro&gt;[,&lt;macro&gt;...]</code></dt>
<dd><p>      Undefine one or more already defined macros, making them unknown for
      the following source to assemble.
</p>
</dd>

<dt><code>pusho/popo</code></dt>
<dd><p>     Options stack directives. <code>pusho</code> pushes the current syntax options onto an 
	internal stack, where they may be restored by a corresponding <code>popo</code> directive at a later time.
</p>
</dd>

<dt><code>pushp "&lt;string&gt;"</code></dt>
<dt><code>pushp '&lt;string&gt;'</code></dt>
<dt><code>pushp &lt;strsym&gt;</code></dt>
<dt><code>popp &lt;strsym&gt;</code></dt>
<dd><p>     String stack directives. <code>pushp</code> pushes the string value specified by
	<code>&lt;string&gt;</code> or <code>&lt;strsym&gt;</code> onto an internal stack. <code>popp</code> can
	then be used to assign previously pushed values to the existing string symbol <code>&lt;strsym&gt;</code>.
</p>
</dd>

<dt><code>pushs/pops</code></dt>
<dd><p>     Section stack directives. <code>pushs</code> pushes the current section onto an 
	internal stack, where it may be restored and reactivated by the <code>pops</code> directive.
</p>
</dd>

<dt><code>radix &lt;base&gt;</code></dt>
<dd><p>      Sets the numeric base for non-prefixed/suffixed numbers to a value of 
	<code>&lt;base&gt;</code>, which must be within a range of <code>2</code> to 
	<code>16</code>.
</p>
</dd>

<dt><code>rept &lt;expression&gt;</code></dt>
<dd><p>      Repeats the assembly of the block between <code>rept</code> and <code>endr</code>
      <code>&lt;expression&gt;</code> number of times. <code>&lt;expression&gt;</code> should be
      positive. Negative values are equivalent to specifying a repeat value of <code>0</code>.
</p>
</dd>

<dt><code>&lt;label&gt; rs &lt;expression&gt;</code></dt>
<dt><code>&lt;label&gt; rsb &lt;expression&gt;</code></dt>
<dt><code>&lt;label&gt; rsw &lt;expression&gt;</code></dt>
<dt><code>&lt;label&gt; rsl &lt;expression&gt;</code></dt>
<dd><p>      Z80/6502 reserve symbol directives. Assigns the current value of the reserve symbol counter (<code>__rs</code>) to
	<code>&lt;label&gt;</code>. Afterwards, the counter is incremented by an ammount corresponding to the directive's size 
	multiplied by <code>&lt;expression&gt;</code>: <code>rs/rsb</code> corresponds to byte, <code>rsw</code> corresponds to word, 
	and <code>rsl</code> corresponds to longword.
</p>
</dd>

<dt><code>&lt;label&gt; rs[.&lt;sz&gt;] &lt;expression&gt;</code></dt>
<dd><p>      M68K reserve symbol directive. Assigns the current value of the reserve symbol counter (<code>__rs</code>) to
	<code>&lt;label&gt;</code>. Afterwards, the counter is incremented by the directives&rsquo;s size
	(<code>&lt;sz&gt;</code>) multiplied by <code>&lt;expression&gt;</code>.
	<code>&lt;sz&gt;</code> defaults to <code>w</code> when not specified.
</p>
</dd>

<dt><code>rseven</code></dt>
<dd><p>      Aligns the reserve symbol counter (<code>__rs</code>) to an even count.
</p>
</dd>
<dt><code>rsreset</code></dt>
<dd><p>      Resets the reserve symbol counter (<code>__rs</code>) to zero.
</p>
</dd>
<dt><code>rsset &lt;expression&gt;</code></dt>
<dd><p>      Sets the reserve symbol counter (<code>__rs</code>) to <code>&lt;expression&gt;</code>.
</p>
</dd>

<dt><code>section &lt;name&gt;[,&quot;&lt;attributes&gt;&quot;]</code></dt>
<dd><p>      Starts a new section named <code>&lt;name&gt;</code> or reactivate an old one. If
      attributes are given for an already existing section, they must
      match exactly. The section&rsquo;s name will also be defined as a new
      symbol, which represents the section&rsquo;s start address.
      The <code>&quot;&lt;attributes&gt;&quot;</code> string may consist of the following characters:
</p>
<p>      Section Contents:
</p><dl compact="compact">
<dt><code>c</code></dt>
<dd><p>         section has code
</p>
</dd>
<dt><code>d</code></dt>
<dd><p>         section has initialized data
</p>
</dd>
<dt><code>u</code></dt>
<dd><p>         section has uninitialized data
</p>
</dd>
<dt><code>i</code></dt>
<dd><p>         section has directives (info section)
</p>
</dd>
<dt><code>n</code></dt>
<dd><p>         section can be discarded
</p>            
</dd>
<dt><code>R</code></dt>
<dd><p>         remove section at link time
</p>            
</dd>
<dt><code>a</code></dt>
<dd><p>         section is allocated in memory
</p></dd>
</dl>

<p>      Section Protection:
</p>
<dl compact="compact">
<dt><code>r</code></dt>
<dd><p>         section is readable
</p>            
</dd>
<dt><code>w</code></dt>
<dd><p>         section is writable
</p>           
</dd>
<dt><code>x</code></dt>
<dd><p>         section is executable
</p>           
</dd>
<dt><code>s</code></dt>
<dd><p>         section is shareable
</p></dd>
</dl>

<p>      When attributes are missing they are automatically set for the section
      names <code>code</code>, <code>text</code>, <code>data</code>, <code>bss</code>.
      Otherwise they default to the attributes for the pre-defined <code>code/text</code> section.
</p>
</dd>

<dt><code>&lt;symbol&gt; set &lt;expression&gt;</code></dt>
<dd><p>      Create a new symbol with the name <code>&lt;symbol&gt;</code> and assign
      the value of <code>&lt;expression&gt;</code>. If <code>&lt;symbol&gt;</code> is 
	  already assigned, it will contain a new value from now on.
</p>
</dd>

<dt><code>shift</code></dt>
<dd><p>      A special directive for use within macros that shifts the list of passed
	macro arguments one place to the left, discarding the leftmost argument. Useful for
	iteration purposes or designing macros which may take a variable number of argumnets.
	The internal symbol <code>__SHIFTN</code> holds the current number of shifts performed
	for the current macro. An error is issued when this directive is used outside of the 
	macro context.
</p>
</dd>

<dt><code>&lt;name&gt; struct/ends</code></dt>
<dd><p>      Defines a structure which can be referenced by <code>&lt;name&gt;</code>. Labels within
      a structure definitation can be used as field offsets. They will be
      defined as local labels of <code>&lt;name&gt;</code> and can be referenced through
      <code>&lt;name&gt;:&lt;label&gt;</code>. All directives are allowed, but instructions will
      be ignored when such a structure is used. Data definitions can be used as
      default values when the structure is used as initializer. The structure
      name, <code>&lt;name&gt;</code>, is defined as a global symbol with the structure&rsquo;s size.
      A structure definition is ended by <code>ends</code>. See the additional section titled "Structures"
	  for more information.
</p>
</dd>

<dt><code>&lt;strsym&gt; substr &lt;start&gt;,&lt;end&gt;,"&lt;string&gt;"</code></dt>
<dt><code>&lt;strsym&gt; substr &lt;start&gt;,&lt;end&gt;,'&lt;string&gt;'</code></dt>
<dt><code>&lt;strsym&gt; substr &lt;start&gt;,&lt;end&gt;,&lt;symbol&gt;</code></dt>
<dd><p>      Declares and assigns a string value to <code>&lt;strsym&gt;</code> based on a sub-string derived
	from <code>&lt;string&gt;</code> or <code>&lt;symbol&gt;</code> between the character indexes 
	<code>&lt;start&gt;</code> and <code>&lt;end&gt</code>. both <code>&lt;start&gt;</code> and 
	<code>&lt;end&gt</code> can optionally be left blank. If <code>&lt;start&gt;</code> is left blank
	sub-string parsing begins at the first character of the given string. If <code>&lt;end&gt</code> is
	left blank, parsing ends after the last character of the string. Any value between <code>0</code> and the
	length of the string is accepted as long as the value of <code>&lt;end&gt</code> is greater 
	than <code>&lt;start&gt;</code>.
	</p>
<p>	Example:</p>
<div class="example">
<pre class="example">part:	substr	10,19,"The quick brown fox jumps over the lazy dog"	; Assigns the sub-string value "brown fox" to 'part'
</pre></div>
</dd>

<dt><code>switch &lt;expression&gt</code></dt>
<dd><p>      Begins a switch statement block of conditional assembly. Unlike conditional blocks consisting of 
	<code>if</code>, <code>else</code>, and <code>elseif</code>, a <code>switch</code> block conditionally 
	assembles code based on whether or not an initial expression, given by <code>&lt;expression&gt</code>, matches the 
	value of any cases specified between the <code>switch</code> and <code>endc/endif</code> directive. Specific 
	cases can be checked through the <code>case</code> directive; if <code>&lt;expression&gt</code> matches the value
	of an expression listed following <code>case</code>, all lines of code following the matched case will be 
	assembled until another case sub-block is encountered. If <code>&lt;expression&gt</code> matches multiple listed
	cases within the switch statement, only the first matched case sub-block will be conditionally assembled; 
	the rest will be ignored. <code>default</code> (or alternatively, <code>else</code>) functions as a special 
	case which will be assembled if no previously listed case matched <code>&lt;expression&gt</code>.
</p>
</dd>

<dt><code>until &lt;expression&gt;</code></dt>
<dd><p>      Do-until loop closure directive. Repeats the code between <code>do</code> and <code>until</code> until
      <code>&lt;expression&gt;</code> evaluates as <code>true</code>. To prevent infinite loops, a default maximum of
			10,000 iterations is permitted. When this ammount is exceeded, the assembler will produce an error. This amount 
			can be raised or lowered with the <code>-maxloopiters=</code> build option, where an integer value specified after
			the <code>=</code> specifies the maximum allowed number of iterations. Specifying a value of <code>0</code> will
			effectively remove the iteration limit, but will allow for the possibility of infite loops.
</p>
</dd>

<dt><code>while &lt;expression&gt;</code></dt>
<dd><p>      While-loop opening directive. Repeats the code between <code>while</code> and <code>endw</code> while
      <code>&lt;expression&gt;</code> evaluates as <code>true</code>. To prevent infinite loops, a default maximum of
			10,000 iterations is permitted. See <code>until</code> above for information on how to adjust this limit.
</p>
</dd>

<dt><code>xdef &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>      Flag <code>&lt;symbol&gt;</code> as externally visible, which means that
      <code>&lt;symbol&gt;</code> is visible to all modules in the linking process.
	  See also <code>global</code>.
</p>
</dd>

<dt><code>xref &lt;symbol&gt;[,&lt;symbol&gt;...]</code></dt>
<dd><p>      Flag <code>&lt;symbol&gt;</code> as externally defined, which means it has to
      be imported from another module into the linking process. See also <code>global</code>.
</p>
</dd>

</dl>
<hr>
<a name="Structures"></a>
<h2 class="section">Structures</h2>
<p>The Psi-X syntax is able to manage structures.
Structures are defined as follows:
</p><div class="example">
<pre class="example">mylabel struct
        &lt;fields&gt;
        ends
</pre></div>
 

<p>Any directive is allowed to define the structure fields. Labels can be used
to define offsets into the structure. Initialized data is used as default
value, whenever no value is given for a field when the structure is referenced.
</p>
<p>Some examples of structure declarations:
</p><div class="example">
<pre class="example">point	struct
x	dc.b	4
y	dc.b	5
z	dc.b	6
	ends
</pre></div>

<p>This will create the following labels:
</p><div class="example">
<pre class="example">point.x  ; 0   offsets
point.y  ; 1
point.z  ; 2
point    ; 3   size of the structure
</pre></div>

<p>The structure can be used by optionally redefining the field values:
</p><div class="example">
<pre class="example">point1	point
point2	point 1, 2, 3
point3	point ,,4
</pre></div>
<p>is equivalent to
</p><div class="example">
<pre class="example">point1  
	dc.b	4
	dc.b	5
	dc.b	6
point2
	dc.b	1
	dc.b	2
	dc.b	3
point3
	dc.b	4
	dc.b	5
	dc.b	4
</pre></div>


<hr>
<a name="Known-Problems-19"></a>
<h2 class="section">Known Problems</h2>

<p>    Some known problems of this module at the moment:
</p>
<ul class="no-bullet">
<li>- n/a
</li></ul>

<hr>
<a name="Error-Messages-20"></a>
<h2 class="section">Error Messages</h2>

<p>This module has the following error messages:
</p>
<ul class="no-bullet">
<li>- 1001: syntax error
</li><li>- 1002: invalid extension
</li><li>- 1003: no space before operands
</li><li>- 1004: too many closing parentheses
</li><li>- 1005: missing closing parentheses
</li><li>- 1006: missing operand
</li><li>- 1007: garbage at end of line
</li><li>- 1008: unexpected "shift" outside of macro
</li><li>- 1009: invalid data operand
</li><li>- 1010: invalid radix base value (%d)
</li><li>- 1011: identifier expected
</li><li>- 1012: assembly failed
</li><li>- 1013: unexpected "%s" without "%s"
</li><li>- 1014: "," expected
</li><li>- 1015: maximum module nesting depth exceeded (%d)
</li><li>- 1016: invalid message severity
</li><li>- 1017: user-defined message: %s
</li><li>- 1018: user-defined warning: %s
</li><li>- 1019: user-defined error: %s
</li><li>- 1020: user-defined fatal error: %s
</li><li>- 1021: skipping instruction in struct init
</li><li>- 1022: last %d bytes of string constant have been cut
</li><li>- 1023: invalid numeric expansion
</li><li>- 1024: enclosed macro argument missing "}"
</li><li>- 1025: invalid "public" parameter (must be either "on" or "off")
</li><li>- 1026: invalid data size value (%d bytes)
</li><li>- 1027: local macro variable <%s> already declared
</li><li>- 1028: string symbol <%s> not found
</li><li>- 1029: quoted string or string symbol expected in operand
</li><li>- 1030: substring index must be positive
</li><li>- 1031: substring ending index cannot be greater than the starting index
</li><li>- 1032: substring ending index cannot be greater than the length of the string
</li><li>- 1033: string stack capacity reached (%d)
</li><li>- 1034: string stack is empty
</li><li>- 1035: invalid option argument \"%c\"
</li><li>- 1036: unrecognized option given
</li><li>- 1037: options stack capacity reached (%d)
</li><li>- 1038: options stack is empty

</li></ul>

<hr>

</body></html>